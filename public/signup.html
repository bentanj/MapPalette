<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MapPalette - Sign Up</title>
  <link rel="icon" href="resources/mappalettelogo.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
        background-color: #f8f9fa;
        position: relative;
        overflow: hidden;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      .video-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: -1;
      }
      
      .video-background video {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: translate(-50%, -50%);
      }

      
      .signup-container {
        max-width: 500px;
        width: 100%;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 1;
        max-height: 75vh;
        overflow-y: auto;
      }
      
      .signup-title {
        font-size: 1.8rem;
        font-weight: 600;
        color: black;
        text-align: center;
        margin-bottom: 1rem;
      }

    .form-label {
      font-weight: 500;
    }

    .profile-upload-container {
      display: flex;
      justify-content: center;
      margin-bottom: 2rem;
    }

    .profile-upload {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      border: 2px dashed #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      background-color: #f8f9fa;
      transition: all 0.3s ease;
    }

    .profile-upload:hover {
      border-color: #FF6B6B;
      background-color: #fff;
    }

    .profile-upload img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }

    .upload-text {
      text-align: center;
      font-size: 0.8rem;
      color: #666;
      padding: 1rem;
      z-index: 1;
    }

    .form-control.is-invalid {
      border-color: #dc3545;
      background-image: none;
    }

    .invalid-feedback {
      display: none;
      color: #dc3545;
      font-size: 0.875rem;
      margin-top: 0.25rem;
    }

    .is-invalid ~ .invalid-feedback {
      display: block;
    }

    .alert-container {
      margin-bottom: 1.5rem;
    }

    .alert {
      display: none;
      margin-bottom: 1rem;
      animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .alert-list {
      margin: 0;
      padding-left: 1.5rem;
      margin-top: 0.5rem;
    }

    .btn {
      width: 100%;
      padding: 10px;
      margin-top: 1rem;
      background: linear-gradient(135deg, #FF6B6B, #FF8E53, #FFD54F);
      color: white;
    }

    .btn:hover {
      background: linear-gradient(135deg, #FFD54F, #FF8E53, #FF6B6B);
      color: white;
    }

    .terms-text, .login-link {
      font-size: 0.9rem;
      color: #666;
      text-align: center;
      margin-top: 1rem;
    }

    .terms-text a, .login-link a {
      color: #FF6B6B;
      text-decoration: none;
    }

    .login-link a:hover {
      text-decoration: underline;
    }
    /* Add these styles to your existing <style> section */

/* Base transitions for form elements */
.form-control, .form-select {
  transition: all 0.3s ease;
  border: 1px solid #ced4da;
}

/* Hover effects for input fields and select */
.form-control:hover, .form-select:hover {
  border-color: #FF6B6B;
  box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.1);
  transform: translateY(-1px);
  background-color: #fff;
}

/* Focus effects for input fields and select */
.form-control:focus, .form-select:focus {
  border-color: #FF6B6B;
  box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.25);
  transform: translateY(-1px);
}

/* Profile upload hover effects */
.profile-upload {
  transition: all 0.3s ease;
}

.profile-upload:hover {
  border-color: #FF6B6B;
  box-shadow: 0 0 0 0.2rem rgba(255, 107, 107, 0.1);
  transform: translateY(-2px);
  background-color: #fff;
}

/* Form label hover effects */
.form-label {
  transition: all 0.3s ease;
  display: inline-block;
}

.form-control:hover + .form-label,
.form-select:hover + .form-label,
.form-control:focus + .form-label,
.form-select:focus + .form-label {
  color: #FF6B6B;
  transform: translateX(5px);
}

/* Enhanced button hover effect */
.btn {
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 107, 107, 0.2);
}
  </style>
</head>
<body>

    <div class="video-background">
        <video autoplay muted loop playsinline>
            <source src="./resources/index/signup-video.mp4" type="video/mp4">
            Your browser does not support the video tag.
          </video>
    </div>
    <div class="justify-content-center align-items-center main-body">
        
        <div class="signup-container">
            <a href="index.html" class="text-decoration-none">
                <div class="d-flex justify-content-center align-items-center pb-2">
                  <img src="./resources/index/mappalettelogo.png" class="img-fluid" style="max-width: 95px; margin-right: 5px;" alt="MapPalette Logo">
                  <h1 class="app-name" style="color: #FF6B6B;">MapPalette</h1>
                </div>
              </a>
            <!-- <h1 class="signup-title">Join Us!</h1> -->

            <!-- Alert Container -->
            <div class="alert-container">
              <!-- Error Alert -->
              <div class="alert alert-danger alert-dismissible fade show" role="alert" id="errorAlert">
                  <strong>Sorry! You are unable to sign in because:</strong>
                  <ul class="alert-list" id="errorList"></ul>
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
          
              <!-- Success Alert -->
              <div class="alert alert-success alert-dismissible fade show" role="alert" id="successAlert" style="display: none;">
                  <strong>Signup successful!</strong> You have successfully signed up. Redirecting you to the homepage...
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            </div>
          
            <!-- Profile Picture Upload -->
            <div class="profile-upload-container">
                <div class="profile-upload" id="profileUpload">
                    <div class="upload-text">Click to upload profile picture</div>
                    <img  id="profilePreview">
                    <input type="file" id="profilePicture" accept="image/png, image/jpeg, image/jpg" style="display: none;">
                </div>
            </div>

            <!-- Signup Form -->
            <form id="signupForm" novalidate>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" placeholder="Enter your email" required>
                    <div class="invalid-feedback">Please enter a valid email address (must contain @ and end with .com)</div>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Enter a password" required>
                    <div class="invalid-feedback">Password must be at least 8 characters, containing 1 uppercase letter and 1 special character</div>
                </div>
                <div class="mb-3">
                    <label for="confirmPassword" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm your password" required>
                    <div class="invalid-feedback">Passwords do not match</div>
                </div>
                <div class="mb-3">
                    <label for="username" class="form-label">Display Name</label>
                    <input type="text" class="form-control" id="username" placeholder="Enter your username" required>
                    <div class="invalid-feedback">Display Name is required</div>
                </div>
                <div class="mb-3">
                    <label for="birthday" class="form-label">Birthday</label>
                    <input type="date" class="form-control" id="birthday" required>
                    <div class="invalid-feedback">Please select your birthday</div>
                </div>
                <div class="mb-3">
                    <label for="gender" class="form-label">Gender</label>
                    <select class="form-select" id="gender" required>
                        <option value="" disabled selected>Select your gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="prefer-not-to-say">Rather not say</option>
                    </select>
                    <div class="invalid-feedback">Please select your gender</div>
                </div>
                <!-- Signup Button with Spinner -->
                <button type="submit" class="btn btn-primary" id="submitButton">
                  <span id="buttonText">Sign Up</span>
                  <span id="spinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                </button>
                
            </form>

            <div class="terms-text">
              By signing up, you agree to our <a href="#" data-bs-toggle="modal" data-bs-target="#tosModal">Terms of Service</a> and <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>.
            </div>

            <div class="login-link">
                Already have an account? <a href="login.html">Login</a>
            </div>
        </div>
    </div>

    <!-- Terms of Service Modal -->
    <div class="modal fade" id="tosModal" tabindex="-1" aria-labelledby="tosModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="tosModalLabel">Terms of Service</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                    <!-- Terms of Service content -->
                    <h2>Terms of Service</h2>
                    <p><strong>Last updated: 14 November 2024</strong><br><br>
                    Welcome to MapPalette! By using MapPalette, you agree to these Terms of Service. Please read them carefully before using the app.<br><br>

                    <strong>1. Acceptance of Terms</strong><br>
                    By accessing or using MapPalette, you confirm that you agree to be bound by these Terms of Service and our Privacy Policy. If you do not agree, please do not use MapPalette.<br><br>

                    <strong>2. Eligibility</strong><br>
                    MapPalette is intended for users aged 13 and older. If you are under 18, please get permission from a parent or guardian.<br><br>

                    <strong>3. User Accounts</strong><br>
                    To use certain features, you may need to create an account. You are responsible for keeping your account information secure and for any activity that occurs under your account.<br><br>

                    <strong>4. Content and Conduct</strong><br>
                    <strong>User Content:</strong> MapPalette allows you to create and share map drawings. You retain ownership of any content you create. However, by uploading, you grant MapPalette a license to use, display, and share your content within the app.<br>
                    <strong>Prohibited Conduct:</strong> Do not upload or share any offensive, harmful, or inappropriate content. Users are expected to interact respectfully and responsibly within the app.<br><br>

                    <strong>5. Privacy</strong><br>
                    By using MapPalette, you consent to our collection, use, and sharing of your information as described in our Privacy Policy.<br><br>

                    <strong>6. Intellectual Property</strong><br>
                    All MapPalette content, including but not limited to graphics, logos, and trademarks, is the property of MapPalette or its licensors. You may not use any part of MapPalette’s content without permission.<br><br>

                    <strong>7. Limitation of Liability</strong><br>
                    MapPalette is provided “as is” and without any warranties. We do not guarantee that the app will be uninterrupted or error-free. MapPalette is not liable for any damages or losses resulting from your use of the app.<br><br>

                    <strong>8. Changes to Terms</strong><br>
                    We reserve the right to update these Terms at any time. We will notify users of significant changes. Continued use of MapPalette constitutes acceptance of the updated Terms.<br><br>

                    <strong>9. Termination</strong><br>
                    We reserve the right to suspend or terminate your account if you violate these Terms or engage in prohibited conduct.<br><br>

                    <strong>10. Contact Us</strong><br>
                    For questions about these Terms, please contact us at support@mappalette.com.<br><br>
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="privacyModalLabel">Privacy Policy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                    <!-- Privacy Policy content -->
                    <h2>Privacy Policy</h2>
                    <p><strong>Last updated: 14 November 2024</strong><br><br>
                    MapPalette is committed to protecting your privacy. This Privacy Policy outlines how we collect, use, and share your information when you use our app.<br><br>

                    <strong>1. Information We Collect</strong><br>
                    <strong>Personal Information:</strong> When creating an account, we may collect information such as your name, email address, and profile information.<br>
                    <strong>Usage Information:</strong> We collect data on how you interact with the app, including location data for map creation, device information, and analytics.<br><br>

                    <strong>2. How We Use Your Information</strong><br>
                    <strong>To Provide Services:</strong> We use your information to provide features like map creation, sharing, and viewing.<br>
                    <strong>To Improve Our Services:</strong> We analyze usage data to improve and personalize the app experience.<br>
                    <strong>To Communicate:</strong> We may use your email to send notifications, updates, or promotional information (which you can opt out of).<br><br>

                    <strong>3. How We Share Your Information</strong><br>
                    <strong>With Third-Party Service Providers:</strong> We may share information with vendors that assist with app operation, analytics, and other services.<br>
                    <strong>For Legal Reasons:</strong> We may disclose information to comply with legal obligations or to protect the rights and safety of our users.<br><br>

                    <strong>4. Data Security</strong><br>
                    We implement appropriate security measures to protect your information. However, no system is completely secure, and we cannot guarantee absolute security.<br><br>

                    <strong>5. Your Rights</strong><br>
                    <strong>Access:</strong> You can request a copy of your data.<br>
                    <strong>Correction:</strong> You can update or correct your personal information.<br>
                    <strong>Deletion:</strong> You can request to delete your account and personal data.<br><br>

                    <strong>6. Children’s Privacy</strong><br>
                    MapPalette is not intended for users under the age of 13. We do not knowingly collect information from children under 13. If we learn that we have collected such information, we will take steps to delete it.<br><br>

                    <strong>7. Changes to This Policy</strong><br>
                    We may update this Privacy Policy periodically. We encourage you to review it regularly to stay informed about our practices.<br><br>

                    <strong>8. Contact Us</strong><br>
                    For questions or concerns about this Privacy Policy, please reach out to privacy@mappalette.com.<br><br>
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Profile picture upload handling
        const profileUpload = document.getElementById('profileUpload');
        const profileInput = document.getElementById('profilePicture');
        const profilePreview = document.getElementById('profilePreview');
        const uploadText = document.querySelector('.upload-text');
        const form = document.getElementById('signupForm');
        const submitButton = document.getElementById('submitButton');
        const spinner = document.getElementById('spinner');
        const buttonText = document.getElementById('buttonText');
        const errorAlert = document.getElementById('errorAlert');
        const errorList = document.getElementById('errorList');
    
        // Profile Upload Functionality
        profileUpload.addEventListener('click', () => profileInput.click());
        profileUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            profileUpload.style.borderColor = '#FF6B6B';
        });
        profileUpload.addEventListener('dragleave', () => profileUpload.style.borderColor = '#ccc');
        
        // Update the drop event listener
        profileUpload.addEventListener('drop', async (e) => {
            e.preventDefault();
            
            if (e.dataTransfer.files.length > 0) {
                // If it's a real file, handle normally
                handleProfileUpload(e.dataTransfer.files[0]);
            } else if (e.dataTransfer.items.length > 0) {
                const item = e.dataTransfer.items[0];
                if (item.kind === 'string' && item.type === 'text/uri-list') {
                    item.getAsString(async (url) => {
                        try {
                            // Fetch the image from the URL
                            const response = await fetch(url);
                            const blob = await response.blob();
                            
                            // Convert blob to a File
                            const file = new File([blob], "downloaded-image.jpg", { type: blob.type });
                            handleProfileUpload(file); // Process the file as needed
                        } catch (error) {
                            console.error("Error fetching image:", error);
                            alert("Unable to retrieve image from URL.");
                        }
                    });
                }
            }
        });
    
        profileInput.addEventListener('change', () => handleProfileUpload(profileInput.files[0]));
    
        // Updated handleProfileUpload function to accept static image formats and log file details
        function handleProfileUpload(file) {
            // Log file details for debugging
            console.log("File name:", file.name);
            console.log("File type:", file.type);
    
            // List of accepted image MIME types
            const acceptedImageTypes = [
                'image/jpeg',
                'image/png',
                'image/jpg',
                'image/bmp',
                'image/webp',
                'image/tiff'
            ];
    
            // List of accepted image extensions as a fallback check
            const acceptedExtensions = ['.jpeg', '.jpg', '.png', '.bmp', '.webp', '.tiff'];
    
            // Check if the file type is an accepted MIME type or if the file extension matches
            const isAcceptedType = file && (acceptedImageTypes.includes(file.type) ||
                                            acceptedExtensions.some(ext => file.name.toLowerCase().endsWith(ext)));
    
            if (isAcceptedType) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    profilePreview.src = e.target.result;
                    profilePreview.style.display = 'block';
                    uploadText.style.display = 'none';
    
                    // Programmatically assign the file to the input
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    profileInput.files = dataTransfer.files; // Assign the file to the input field
                };
                reader.readAsDataURL(file);
            } else {
                alert('Please select a valid static image file (JPG, JPEG, PNG, BMP, WEBP, or TIFF).');
            }
        }
    
        // Helper Functions for Validation
        function validateEmail(email) {
            return /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email);
        }
    
        function validatePassword(password) {
            return password.length >= 8 && /[A-Z]/.test(password) && /[!@#$%^&*(),.?":{}|<>]/.test(password);
        }
    
        function validateField(field) {
            const error = {
                isValid: true,
                message: ''
            };
    
            const value = field.value.trim();
            
            if (!value) {
                error.isValid = false;
                error.message = `${field.previousElementSibling.textContent.replace('*', '')} is required`;
                return error;
            }
    
            switch (field.id) {
                case 'email':
                    if (!validateEmail(value)) {
                        error.isValid = false;
                        error.message = 'Please enter a valid email address (must contain @ and end with .com)';
                    }
                    break;
                case 'password':
                    if (!validatePassword(value)) {
                        error.isValid = false;
                        error.message = 'Password must be at least 8 characters, contain 1 uppercase letter and 1 special character';
                    }
                    break;
                case 'confirmPassword':
                    if (value !== document.getElementById('password').value) {
                        error.isValid = false;
                        error.message = 'Passwords do not match';
                    }
                    break;
            }
    
            return error;
        }
    
        function showErrors(errors) {
            errorList.innerHTML = ''; // Clear previous errors
            
            errors.forEach(error => {
                const li = document.createElement('li');
                li.textContent = error;
                errorList.appendChild(li);
            });
            
            errorAlert.style.display = 'block';
            
            // Scroll to top of container to show error
            document.querySelector('.signup-container').scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
    
        // Form Event Listener for Input Fields
        form.querySelectorAll('input, select').forEach(field => {
            field.addEventListener('blur', () => {
                const validation = validateField(field);
                field.classList.toggle('is-invalid', !validation.isValid);
                if (!validation.isValid) {
                    field.nextElementSibling.textContent = validation.message;
                }
            });
    
            field.addEventListener('input', () => {
                field.classList.remove('is-invalid');
                errorAlert.style.display = 'none';
            });
        });
    
        // Form Submit Event
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const errors = [];
            let isValid = true;
    
            // Validate all fields
            form.querySelectorAll('input, select').forEach(field => {
                const validation = validateField(field);
                field.classList.toggle('is-invalid', !validation.isValid);
                
                if (!validation.isValid) {
                    isValid = false;
                    errors.push(validation.message);
                }
            });
    
            if (!isValid) {
                showErrors(errors);
                return;
            }
    
            // If valid, show spinner and disable button
            spinner.style.display = 'inline-block';
            buttonText.style.display = 'none';
            submitButton.disabled = true;
    
            // Allow Firebase's submit handler to take over
        });
    </script>
    <script type="module" src="firebase.js"></script>
</body>
</html>
