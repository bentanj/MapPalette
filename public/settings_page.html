<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MapPalette Settings</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- existing CSS (included homepage for the nav bar css code) -->
    <link rel="stylesheet" href="homepage_style.css">
    <link rel="stylesheet" href="settings_style.css">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        <!-- Navbar -->
        <nav-bar :user_profile="userProfile"></nav-bar>
        
        <div class="main-content-wrapper">
            <div class="container-fluid mt-4">
                <div class="row">
                    <!-- Settings Sidebar -->
                    <div class="col-lg-3 col-md-4">
                        <div class="settings-sidebar bg-white p-4 rounded shadow-sm">
                            <h5 class="fw-bold mb-4">Settings</h5>
                            <div class="settings-nav">
                                <a v-for="item in navItems" 
                                :key="item.id"
                                href="#"
                                class="settings-nav-item mb-2 text-decoration-none"
                                :class="{ 'active': currentTab === item.id }"
                                @click.prevent="switchTab(item.id)">
                                    <div class="d-flex align-items-start w-100">
                                        <div class="me-3">
                                            <i :class="item.icon + ' fs-5'"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <div class="fw-medium">{{ item.label }}</div>
                                            <small class="text-muted">{{ item.description }}</small>
                                        </div>
                                        <div class="ms-2 d-flex align-items-center">
                                            <i class="bi bi-chevron-right"></i>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-1"></div>
                    <!-- Settings Content -->
                    <div class="col-lg-7 col-md-8">
                        <div class="settings-content bg-white p-4 rounded shadow-sm">
                            <!-- Profile Section -->
                            <div v-if="currentTab === 'profile'" class="settings-section">
                                <h3 class="mb-4">My Profile</h3>
                                
                                <!-- Profile Picture -->
                                <div class="text-center mb-4">
                                    <h6 class="fw-bold mb-0">Profile Picture</h6>
                                    <div class="profile-picture-container">
                                        <img :src="userProfile.avatar" class="profile-picture" alt="Profile Picture">
                                        <input 
                                            type="file" 
                                            ref="fileInput" 
                                            @change="handleImageUpload" 
                                            accept="image/*" 
                                            style="display: none"
                                        >
                                        <div class="profile-picture-buttons mt-3">
                                            <button class="btn btn-primary me-2" @click="$refs.fileInput.click()">
                                                <i class="bi bi-camera-fill me-1"></i>
                                                Change Picture
                                            </button>
                                            <button v-if="userProfile.avatar !== 'resources/default-avatar.png'" 
                                                    class="btn btn-outline-danger"
                                                    @click="removeProfilePicture">
                                                <i class="bi bi-trash me-1"></i>
                                                Remove
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Profile Form -->
                                <form class="profile-form">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" v-model="userProfile.name">
                                            <button class="btn btn-outline-secondary" type="button">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Birthday</label>
                                        <input type="date" class="form-control" v-model="userProfile.birthday">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Gender</label>
                                        <select class="form-select" v-model="userProfile.gender">
                                            <option value="Man">Man</option>
                                            <option value="Woman">Woman</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </form>
                            </div>
                            <!-- Account Section -->
                            <div v-if="currentTab === 'account'" class="settings-section">
                                <h3 class="mb-4">My Account</h3>
                                
                                <!-- Email Section -->
                                <div class="account-section mb-4">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="fw-bold mb-0">Email address</h6>
                                    </div>
                                    <div v-if="!showEmailChange" class="d-flex justify-content-between align-items-center p-3 bg-light rounded">
                                        <span class="text-muted">Your email address is <span class="fw-bold">{{ userProfile.email }}</span></span>
                                        <button @click="showEmailChange = true" 
                                                class="btn btn-link text-decoration-none">Change</button>
                                    </div>
                                    <!-- Email Change Form -->
                                    <div v-if="showEmailChange" class="mt-3">
                                        <form @submit.prevent="updateEmail" class="email-change-form bg-white">
                                            <div class="mb-3">
                                                <label class="form-label">New email address</label>
                                                <input type="email" 
                                                    class="form-control" 
                                                    v-model="newEmail" 
                                                    required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label">Current password</label>
                                                <input type="password" 
                                                    class="form-control" 
                                                    v-model="currentPassword" 
                                                    required>
                                            </div>
                                            <div class="d-flex gap-2">
                                                <button type="submit" 
                                                        class="btn btn-primary"
                                                        :disabled="!newEmail || !currentPassword">
                                                    Save changes
                                                </button>
                                                <button type="button" 
                                                        class="btn btn-light"
                                                        @click="cancelEmailChange">
                                                    Cancel
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>

                                <!-- Password section -->
                                <div class="account-section mb-4">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <h6 class="fw-bold mb-0">Password</h6>
                                    </div>

                                    <!-- Password Form -->
                                    <div class="password-section bg-white p-4 rounded">
                                        <div class="row g-4">
                                            <div class="col-md-6">
                                                <label class="form-label fw-medium">New password</label>
                                                <div class="password-input-group">
                                                    <input type="password" 
                                                        class="form-control" 
                                                        v-model="newPassword" 
                                                        placeholder="Enter new password">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label fw-medium">Current password</label>
                                                <div class="password-input-group">
                                                    <input type="password" 
                                                        class="form-control" 
                                                        v-model="currentPassword" 
                                                        placeholder="Enter current password">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="d-flex flex-column gap-3 mt-4">
                                            <div>
                                                <button @click="updatePassword" 
                                                        class="btn btn-primary save-password-btn"
                                                        :disabled="!newPassword || !currentPassword">
                                                    Save password
                                                </button>
                                            </div>
                                            
                                            <div>
                                                <a href="#" 
                                                @click.prevent="resetPassword" 
                                                class="text-primary text-decoration-none">
                                                    Can't remember your current password? Reset your password
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-1"></div>
                </div>
            </div>
        </div>
        
        <!-- Footer Section -->
        <site-footer></site-footer>
    </div>

    <!-- Vue App -->
    <script>
        const { createApp } = Vue 

        const app = createApp({
            data() {
                return {
                    currentTab: 'profile',
                    showEmailChange: false,    
                    newEmail: '',
                    newPassword: '',
                    currentPassword: '', 
                    userProfile: {           
                        name: 'Wei Shen',
                        avatar: 'resources/download.jpeg',
                        birthday: '2002-04-15',
                        gender: 'Man',
                        // may not want to implement change email func
                        email: 'ilovewad2@private.com',
                        password: 'password'
                    },
                    navItems: [
                        {
                            id: 'profile',
                            icon: 'bi bi-person',
                            label: 'Profile Settings',
                            description: 'Manage your personal information'
                        },
                        {
                            id: 'account',
                            icon: 'bi bi-shield-lock',
                            label: 'Account Settings',
                            description: 'Security and account preferences'
                        },
                        // extra stuff as placeholder.
                        {
                            id: 'privacy',
                            icon: 'bi bi-eye',
                            label: 'Privacy',
                            description: 'Control your privacy settings'
                        },
                        {
                            id: 'notifications',
                            icon: 'bi bi-bell',
                            label: 'Notifications',
                            description: 'Manage your notifications'
                        },
                        {
                            id: 'connected',
                            icon: 'bi bi-link-45deg',
                            label: 'Connected Apps',
                            description: 'Manage your connected applications'
                        }
                    ]
                }
            },
            methods: {
                switchTab(tabId) {
                    this.currentTab = tabId;
                },
                togglePasswordVisibility() {
                    this.showPassword = !this.showPassword;
                },
                
                updateEmail() {
                    // make an API call to update the email
                    this.userProfile.email = this.newEmail;
                    this.cancelEmailChange();
                },
                
                cancelEmailChange() {
                    this.showEmailChange = false;
                    this.newEmail = '';
                    this.currentPassword = '';
                },
                
                updatePassword() {
                    // make an API call to update the password
                    this.userProfile.password = '••••••••••';
                    this.cancelPasswordChange();
                },
                
                cancelPasswordChange() {
                    this.showPasswordChange = false;
                    this.newPassword = '';
                    this.currentPassword = '';
                },
                
                resetPassword() {
                    // Implement password reset logic
                    alert('Password reset email sent!');
                }
            }
        })
        
    </script>

<!-- import navbar from navbar.js -->
<script src="navbar/navbar.js"></script>

<!-- import footer from footer.js -->
<script src="footer/footer.js"></script>

<script>
    app.mount('#app')
</script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>